{"file":"verify-C7Yq3EcP.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;AAKQ,UAAA,MAAM,IAAI,EAAE;AACZ,UAAA,UAAU,IAAI,EAAE;AAChB,UAAA,SAAS,IAAI,KAAK;AAGP,sBAAkB;AACpB,cAAU;AAmDjB,YAAA;AAAA,MACA,OAAO;AAAA,MACP,MAAM;AAAA,QACN;AAAA,UACI,MAAM;AAAA,UACN,SAAS;AAAA,QACb;AAAA,QACA;AAAA,UACI,MAAM;AAAA,UACN,SAAS;AAAA,QAAA;AAAA,MACb;AAAA,IACA,CACP;;;;;;;;;;;;;;;;;;","names":[],"sources":["../../../../pages/verify.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\n\r\n  import { useSupabaseClient } from '#imports'\r\n\r\n  // ตัวแปรสำหรับเก็บข้อมูล OTP และข้อความแจ้งเตือน\r\n  const otp = ref('')\r\n  const message = ref('')\r\n  const status = ref(false)\r\n\r\n  // Supabase Client และ Router\r\n  const supabase = useSupabaseClient()\r\n  const router = useRouter()\r\n\r\n  // ฟังก์ชันยืนยัน OTP\r\n  const handleVerifyOTP = async () => {\r\n    if (!otp.value) {\r\n      message.value = 'Please enter the OTP.'\r\n      status.value = false\r\n      return\r\n    }\r\n\r\n    try {\r\n      // ยืนยัน OTP กับ Supabase\r\n      const { data, error } = await supabase.auth.verifyOtp({\r\n        phone: localStorage.getItem('phone') as string,\r\n        token: otp.value,\r\n        type: 'sms', // ประเภทการยืนยัน OTP ผ่าน SMS\r\n      })\r\n\r\n      if (error) throw error\r\n\r\n      // ถ้าสำเร็จ เก็บ access_token ลงใน cookies\r\n      const token = data.session?.access_token\r\n      if (token) {\r\n        const authToken:any = useCookie('auth_token')\r\n        authToken.value = token\r\n        authToken.options = { expires: 7 } // กำหนดวันหมดอายุของ cookie\r\n      }\r\n\r\n      message.value = 'Verification successful!'\r\n      status.value = true\r\n\r\n      // พาไปยังหน้า dashboard\r\n      await new Promise(resolve => setTimeout(resolve, 1000))\r\n      router.push('/backend/dashboard')\r\n\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        message.value = error.message\r\n        status.value = false\r\n      } else {\r\n        message.value = 'An unknown error occurred'\r\n        status.value = false\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  definePageMeta({\r\n          layout: 'auth',\r\n  })\r\n\r\n  useHead({\r\n          title: 'Verify OTP',\r\n          meta: [\r\n          { \r\n              name: 'keywords', \r\n              content: 'Verify OTP, Nuxt 3, Backend'\r\n          },\r\n          {\r\n              name: 'Description',\r\n              content: 'Verify OTP Nuxt 3,  IT Genius Engineering'\r\n          }\r\n          ]\r\n  })\r\n\r\n</script>\r\n\r\n<template>\r\n    <div class=\"bg-base-200 h-[calc(100vh-50px)] flex items-center justify-center\">\r\n      <div class=\"card bg-base-100 shadow-xl max-w-md w-full p-6\">\r\n        <h2 class=\"card-title text-2xl font-bold mb-6\">Verify OTP</h2>\r\n\r\n        <p v-if=\"message\" :class=\"status ? 'bg-success' : 'bg-error'\" class=\"p-3 rounded-lg text-white mb-4\">\r\n          {{ message }}\r\n        </p>\r\n  \r\n        <form @submit.prevent=\"handleVerifyOTP\">\r\n          <div class=\"form-control\">\r\n            <label class=\"label\">\r\n              <span class=\"label-text\">Enter OTP</span>\r\n            </label>\r\n            <input v-model=\"otp\" type=\"text\" class=\"input input-bordered w-full\" placeholder=\"Enter OTP\" />\r\n          </div>\r\n          <div class=\"form-control mt-6\">\r\n            <button type=\"submit\" class=\"btn btn-primary w-full\">Verify OTP</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n</template>\r\n\r\n<style scoped>\r\n\r\n</style>"],"version":3}