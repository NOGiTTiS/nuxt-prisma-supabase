{"version":3,"file":"login-BFRz4XfB.js","sources":["../../../../pages/login.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\n\r\n  import { useSupabaseClient } from '#imports'\r\n\r\n  // ตัวแปรสำหรับการทำ routing ระหว่างหน้า\r\n  const router = useRouter()\r\n\r\n  // สร้างตัวแปรสำหรับเก็บค่า email และ password ที่ผู้ใช้กรอกเข้ามา\r\n  const email = ref('')\r\n  const password = ref('')\r\n  const phone = ref('+66')\r\n\r\n  // สร้างตัวแปรสำหรับเก็บข้อความแสดงผล\r\n  const message = ref('')\r\n  const status = ref(false)\r\n\r\n  // สร้างตัวแปรสำหรับเรียกใช้งาน Supabase Client\r\n  const supabase = useSupabaseClient()\r\n\r\n  // ฟังก์ชันเข้าสู่ระบบด้วยอีเมลและรหัสผ่าน\r\n  const handleLogin = async () => {\r\n      // console.log('email:', email.value)\r\n      // console.log('password:', password.value)\r\n      // Valideate ข้อมูลที่ผู้ใช้กรอกเข้ามา แบบ if else บ้านๆ\r\n      if (!email.value || !password.value) {\r\n          message.value = 'Please enter both email and password.'\r\n          status.value = false\r\n          return\r\n      }\r\n\r\n      try {\r\n          // ใช้ supabase.auth.signInWithPassword() เพื่อสมัครสมาชิก\r\n          const { data, error } = await supabase.auth.signInWithPassword({\r\n              email: email.value,\r\n              password: password.value,\r\n          })\r\n\r\n          if (error) throw error\r\n\r\n          // หาก login สำเร็จให้นำ access token ไปเก็บไว้ใน cookie\r\n          const token = data.session?.access_token\r\n\r\n          console.log('token:', token)\r\n\r\n          if (token) {\r\n            const authTokens: any = useCookie('auth_tokens') // กำหนดชื่อ cookie ที่เก็บ token\r\n            authTokens.value = token\r\n            authTokens.options = { expires: 7 } // กำหนดเวลาในการเก็บ cookie 7 วัน\r\n          }\r\n\r\n          message.value = 'Login successful!'\r\n          status.value = true\r\n\r\n          // Delay ไว้ 2 วินาที แล้ว redirect ไปหน้า dashboard\r\n          await new Promise(resolve => setTimeout(resolve, 2000))\r\n          router.push('/backend/dashboard')\r\n\r\n      } catch(error: unknown) {\r\n          if(error instanceof Error) {\r\n              message.value = error.message\r\n              status.value = false\r\n          } else {\r\n              message.value = 'An unknown error occurred'\r\n              status.value = false\r\n          }\r\n      }\r\n  }\r\n\r\n  // ฟังก์ชันเข้าสู่ระบบด้วยเบอร์โทรศัพท์\r\n  const handleLoginWithPhone = async () => {\r\n        if (!phone.value) {\r\n            message.value = 'Please enter your phone number.'\r\n            status.value = false\r\n            return\r\n        }\r\n\r\n        try {\r\n            const { error } = await supabase.auth.signInWithOtp({\r\n                phone: phone.value,\r\n            })\r\n\r\n            if (error) throw error\r\n\r\n            // บันทึกเบอร์โทรศัพท์ใน localStorage\r\n            localStorage.setItem('phone', phone.value)\r\n\r\n            message.value = 'OTP sent! Please check your phone for the verification code.'\r\n            status.value = true\r\n\r\n            // Redirect ไปหน้า verify OTP\r\n            router.push('/verify')\r\n\r\n        } catch (error: unknown) {\r\n            if (error instanceof Error) {\r\n            message.value = error.message\r\n            status.value = false\r\n            } else {\r\n            message.value = 'An unknown error occurred'\r\n            status.value = false\r\n            }\r\n        }\r\n  }\r\n\r\n  // ไว้กำหนด Meta ของหน้าเว็บ เช่น title, description, keyword รวมทั้ง layout ที่ใช้\r\n  definePageMeta({\r\n      layout: 'auth',\r\n  })\r\n\r\n  useHead({\r\n      title: 'Login',\r\n      meta: [\r\n      { \r\n          name: 'keywords', \r\n          content: 'Login, Nuxt 3, Backend'\r\n      },\r\n      {\r\n          name: 'Description',\r\n          content: 'Login Nuxt 3,  IT Genius Engineering'\r\n      }\r\n      ]\r\n  })\r\n\r\n</script>\r\n\r\n<template>\r\n    <div class=\"bg-base-200 h-[calc(100vh-50px)] flex items-center justify-center\">\r\n      <div class=\"card lg:card-side bg-base-100 shadow-xl max-w-4xl w-full\">\r\n        <figure class=\"lg:w-1/2\">\r\n          <img src=\"https://media.tenor.com/p0G_bmA2vSYAAAAd/login.gif\" alt=\"Random image\" class=\"object-cover w-full h-full\" />\r\n        </figure>\r\n        <div class=\"card-body lg:w-1/2\">\r\n          <h2 class=\"card-title text-2xl font-bold mb-6\">Login</h2>\r\n  \r\n          <!-- ฟอร์มเข้าสู่ระบบด้วยอีเมล -->\r\n          <form @submit.prevent=\"handleLogin\">\r\n\r\n            <p v-if=\"message\" :class=\"status ? 'bg-success': 'bg-error'\" class=\"p-3 rounded-lg text-white\">\r\n                {{ message}} \r\n            </p>\r\n\r\n            <div class=\"form-control\">\r\n              <label class=\"label\">\r\n                <span class=\"label-text\">Email</span>\r\n              </label>\r\n              <label class=\"input input-bordered flex items-center gap-2\">\r\n                <input v-model=\"email\" type=\"email\" class=\"grow\" placeholder=\"email@example.com\" />\r\n              </label>\r\n            </div>\r\n            <div class=\"form-control mt-4\">\r\n              <label class=\"label\">\r\n                <span class=\"label-text\">Password</span>\r\n              </label>\r\n              <label class=\"input input-bordered flex items-center gap-2\">\r\n                <input v-model=\"password\" type=\"password\" class=\"grow\" placeholder=\"Enter password\" />\r\n              </label>\r\n            </div>\r\n            <div class=\"form-control mt-6\">\r\n              <button type=\"submit\" class=\"btn btn-primary w-full\">Login with Email</button>\r\n            </div>\r\n          </form>\r\n  \r\n          <!-- Divider สำหรับแบ่งส่วน -->\r\n          <div class=\"divider\">OR</div>\r\n  \r\n          <!-- ฟอร์มเข้าสู่ระบบด้วยเบอร์โทรศัพท์ -->\r\n          <form @submit.prevent=\"handleLoginWithPhone\">\r\n            <div class=\"form-control\">\r\n              <label class=\"label\">\r\n                <span class=\"label-text\">Phone Number</span>\r\n              </label>\r\n              <label class=\"input input-bordered flex items-center gap-2\">\r\n                <input v-model=\"phone\" type=\"tel\" class=\"grow\" placeholder=\"+1234567890\" />\r\n              </label>\r\n            </div>\r\n            <div class=\"form-control mt-6\">\r\n              <button type=\"submit\" class=\"btn btn-primary w-full\">Login with Phone</button>\r\n            </div>\r\n          </form>\r\n  \r\n          <div class=\"text-center mt-4\">\r\n            <p>Don't have an account?</p>\r\n            <NuxtLink to=\"/register\" class=\"link link-primary\">Sign up now</NuxtLink>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n</template>\r\n\r\n<style scoped>\r\n\r\n</style>"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAKiB,cAAU;AAGnB,UAAA,QAAQ,IAAI,EAAE;AACd,UAAA,WAAW,IAAI,EAAE;AACjB,UAAA,QAAQ,IAAI,KAAK;AAGjB,UAAA,UAAU,IAAI,EAAE;AAChB,UAAA,SAAS,IAAI,KAAK;AAGP,sBAAkB;AA2F3B,YAAA;AAAA,MACJ,OAAO;AAAA,MACP,MAAM;AAAA,QACN;AAAA,UACI,MAAM;AAAA,UACN,SAAS;AAAA,QACb;AAAA,QACA;AAAA,UACI,MAAM;AAAA,UACN,SAAS;AAAA,QAAA;AAAA,MACb;AAAA,IACA,CACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}